import*as e from"react";import{PrimeReactContext as r,localeOption as t}from"primereact/api";import{ComponentBase as n,useHandleStyle as l}from"primereact/componentbase";import{useMountEffect as o,useUpdateEffect as a,useUnmountEffect as c}from"primereact/hooks";import{classNames as u,mergeProps as i,ObjectUtils as s}from"primereact/utils";function f(e,r){(null==r||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function m(e){if(Array.isArray(e))return f(e)}function d(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(e,r){if(e){if("string"==typeof e)return f(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?f(e,r):void 0}}function y(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function h(e){return m(e)||d(e)||p(e)||y()}function v(e){if(Array.isArray(e))return e}function g(e,r){var t=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=t){var n,l,o,a,c=[],u=!0,i=!1;try{if(o=(t=t.call(e)).next,0===r){if(Object(t)!==t)return;u=!1}else for(;!(u=(n=o.call(t)).done)&&(c.push(n.value),c.length!==r);u=!0);}catch(e){i=!0,l=e}finally{try{if(!u&&null!=t.return&&(a=t.return(),Object(a)!==a))return}finally{if(i)throw l}}return c}}function b(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var w=n.extend({defaultProps:{__TYPE:"DataScroller",id:null,value:null,rows:0,inline:!1,scrollHeight:null,loader:!1,buffer:.9,style:null,className:null,onLazyLoad:null,emptyMessage:null,itemTemplate:null,header:null,footer:null,lazy:!1,children:void 0},css:{classes:{header:"p-datascroller-header",footer:"p-datascroller-footer",content:"p-datascroller-content",list:"p-datascroller-list",root:function(e){return u("p-datascroller p-component",{"p-datascroller-inline":e.props.inline})}},styles:"\n@layer primereact {\n    .p-datascroller .p-datascroller-header {\n        text-align: center;\n        padding: .5em .75em;\n        border-bottom: 0 none;\n    }\n    \n    .p-datascroller .p-datascroller-footer {\n        text-align: center;\n        padding: .25em .625em;\n        border-top: 0px none;\n    }\n    \n    .p-datascroller .p-datascroller-content {\n        padding: .25em .625em;\n    }\n    \n    .p-datascroller-inline .p-datascroller-content {\n        overflow: auto;\n    }\n    \n    .p-datascroller .p-datascroller-list {\n        list-style-type: none; \n        margin: 0;\n        padding: 0;\n    }\n}\n",inlineStyles:{content:function(e){return{maxHeight:e.props.scrollHeight}}}}}),E=e.memo(e.forwardRef((function(n,f){var m,d,y=e.useContext(r),E=w.getProps(n,y),S=e.useState([]),x=(d=2,v(m=S)||g(m,d)||p(m,d)||b()),H=x[0],L=x[1],A=w.setMetaData({props:E}),N=A.ptm,T=A.cx,z=A.sx;l(w.css.styles,A.isUnstyled,{name:"datascroller"});var M=e.useRef(null),R=e.useRef(null),j=e.useRef(E.value),I=e.useRef([]),O=e.useRef(0),P=e.useRef(null),C=function(){if(E.lazy)E.onLazyLoad&&E.onLazyLoad(_()),O.current+=E.rows;else if(j.current){for(var e=O.current;e<O.current+E.rows&&!(e>=j.current.length);e++)I.current.push(j.current[e]);0!==j.current.length&&(O.current+=E.rows),L(h(I.current))}},D=function(){O.current=0,I.current=[],L(h(I.current)),C()},_=function(){return{first:O.current,rows:E.rows}},k=function(){P.current&&(E.inline&&R.current?R.current.removeEventListener("scroll",P.current):E.loader||window.removeEventListener("scroll",P.current)),P.current=null};o((function(){C(),E.loader||(E.inline?(P.current=function(){R.current.scrollTop>=R.current.scrollHeight*E.buffer-R.current.clientHeight&&C()},R.current.addEventListener("scroll",P.current)):(P.current=function(){var e=document.body,r=document.documentElement,t=window.pageYOffset||document.documentElement.scrollTop,n=r.clientHeight;t>=Math.max(e.scrollHeight,e.offsetHeight,n,r.scrollHeight,r.offsetHeight)*E.buffer-n&&C()},window.addEventListener("scroll",P.current)))})),a((function(){E.value&&(j.current=E.value,E.lazy||(O.current=0),I.current=[],E.lazy?(I.current=j.current,L(h(I.current))):C())}),[E.value]),a((function(){E.loader&&k()}),[E.loader]),c((function(){P.current&&k()})),e.useImperativeHandle(f,(function(){return{props:E,load:C,reset:D,getElement:function(){return M.current},getContent:function(){return R.current}}}));var U,Y,J=function(r,t){var n=i({key:t+"_datascrollitem"},N("item")),l=E.itemTemplate?E.itemTemplate(r):r;return e.createElement("li",n,l)},X=function(){var r=i(N("emptyMessage")),n=s.getJSXElement(E.emptyMessage,E)||t("emptyMessage");return e.createElement("li",r,n)},$=(U=i({className:T("header")},N("header")),E.header?e.createElement("div",U,E.header):null),q=(Y=i({className:T("footer")},N("footer")),E.footer?e.createElement("div",Y,E.footer):null),B=function(){var r=i({ref:R,className:T("content"),style:z("content")},N("content")),t=i({className:T("list")},N("list")),n=s.isNotEmpty(H)?H.map(J):X();return e.createElement("div",r,e.createElement("ul",t,n))}(),F=i({id:E.id,ref:M,className:u(E.className,T("root"))},w.getOtherProps(E),N("root"));return e.createElement("div",F,$,B,q)})));E.displayName="DataScroller";export{E as DataScroller};
