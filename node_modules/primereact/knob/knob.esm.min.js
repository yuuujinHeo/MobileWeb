import*as e from"react";import{PrimeReactContext as t}from"primereact/api";import{useEventListener as n}from"primereact/hooks";import{classNames as r,mergeProps as a}from"primereact/utils";import{ComponentBase as o,useHandleStyle as i}from"primereact/componentbase";function l(e){if(Array.isArray(e))return e}function c(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o,i,l=[],c=!0,s=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){s=!0,a=e}finally{try{if(!c&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(s)throw a}}return l}}function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function u(e,t){if(e){if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?s(e,t):void 0}}function m(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function f(e,t){return l(e)||c(e,t)||u(e,t)||m()}var d=o.extend({defaultProps:{__TYPE:"Knob",id:null,style:null,className:null,value:null,size:100,disabled:!1,readOnly:!1,showValue:!0,step:1,min:0,max:100,strokeWidth:14,name:null,valueColor:"var(--primary-color, Black)",rangeColor:"var(--surface-border, LightGray)",textColor:"var(--text-color-secondary, Black)",valueTemplate:"{value}",onChange:null,children:void 0},css:{classes:{range:"p-knob-range",value:"p-knob-value",label:"p-knob-text",root:function(e){var t=e.props;return r("p-knob p-component",{"p-disabled":t.disabled},t.className)}},styles:"\n        @keyframes dash-frame {\n            100% {\n                stroke-dashoffset: 0;\n            }\n        }\n        @layer primereact {\n            .p-knob-range {\n                fill: none;\n                transition: stroke .1s ease-in;\n            }\n            .p-knob-value {\n                animation-name: dash-frame;\n                animation-fill-mode: forwards;\n                fill: none;\n            }\n            .p-knob-text {\n                font-size: 1.3rem;\n                text-align: center;\n            }\n        }\n        "}}),p=40,h=4*Math.PI/3,v=-Math.PI/3,y=e.memo(e.forwardRef((function(r,o){var l=e.useContext(t),c=d.getProps(r,l),s=d.setMetaData({props:c}),u=s.ptm,m=s.cx;i(d.css.styles,s.isUnstyled,{name:"knob"});var y=e.useRef(null),b=!c.disabled&&!c.readOnly,g=f(n({target:"window",type:"mousemove",listener:function(e){W(e.offsetX,e.offsetY),e.preventDefault()},when:b}),2),w=g[0],M=g[1],k=f(n({target:"window",type:"mouseup",listener:function(e){M(),C(),e.preventDefault()},when:b}),2),x=k[0],C=k[1],E=f(n({target:"window",type:"touchmove",listener:function(e){if(1===e.touches.length){var t=y.current.getBoundingClientRect(),n=e.targetTouches.item(0);W(n.clientX-t.left,n.clientY-t.top),e.preventDefault()}},when:b}),2),I=E[0],A=E[1],P=f(n({target:"window",type:"touchend",listener:function(){A(),O()},when:b}),2),N=P[0],O=P[1],S=function(e,t,n,r,a){return(e-t)*(a-r)/(n-t)+r},T=function(){return S(c.min>0&&c.max>0?c.min:0,c.min,c.max,h,v)},z=function(){return S(c.value,c.min,c.max,h,v)},D="M ".concat(50+Math.cos(h)*p," ").concat(50-Math.sin(h)*p," A ").concat(p," ").concat(p," 0 1 1 ").concat(50+Math.cos(v)*p," ").concat(50-Math.sin(v)*p),j="M ".concat(50+Math.cos(T())*p," ").concat(50-Math.sin(T())*p," A ").concat(p," ").concat(p," 0 ").concat(Math.abs(T()-z())<Math.PI?0:1," ").concat(z()>T()?0:1," ").concat(50+Math.cos(z())*p," ").concat(50-Math.sin(z())*p),W=function(e,t){var n=Math.atan2(c.size/2-t,e-c.size/2),r=-Math.PI/2-Math.PI/6;B(n,r)},B=function(e,t){var n;if(e>v)n=S(e,h,v,c.min,c.max);else{if(!(e<t))return;n=S(e+2*Math.PI,h,v,c.min,c.max)}c.onChange&&c.onChange({value:Math.round((n-c.min)/c.step)*c.step+c.min})};e.useImperativeHandle(o,(function(){return{props:c,getElement:function(){return y.current}}}));var Y=a({x:50,y:57,textAnchor:"middle",fill:c.textColor,className:m("label"),name:c.name},u("label")),R=c.showValue&&e.createElement("text",Y,c.valueTemplate.replace("{value}",c.value.toString())),U=a({ref:y,id:c.id,className:m("root"),style:c.style},u("root")),X=a({viewBox:"0 0 100 100",width:c.size,height:c.size,onClick:function(e){return t=e,void(c.disabled||c.readOnly||W(t.nativeEvent.offsetX,t.nativeEvent.offsetY));var t},onMouseDown:function(e){return t=e,w(),x(),void t.preventDefault();var t},onMouseUp:function(e){return M(),void C()},onTouchStart:function(e){return I(),void N()},onTouchEnd:function(e){return A(),void O()}},u("svg")),K=a({d:D,strokeWidth:c.strokeWidth,stroke:c.rangeColor,className:m("range")},u("range")),V=a({d:j,strokeWidth:c.strokeWidth,stroke:c.valueColor,className:m("value")},u("value"));return e.createElement("div",U,e.createElement("svg",X,e.createElement("path",K),e.createElement("path",V),R))})));y.displayName="Knob";export{y as Knob};
