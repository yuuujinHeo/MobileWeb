import*as e from"react";import{PrimeReactContext as t,localeOption as n}from"primereact/api";import{ComponentBase as r,useHandleStyle as o}from"primereact/componentbase";import{classNames as a,ObjectUtils as l,mergeProps as i,IconUtils as c,DomHandler as u}from"primereact/utils";import{Button as s}from"primereact/button";import{PlusIcon as p}from"primereact/icons/plus";import{TimesIcon as d}from"primereact/icons/times";import{UploadIcon as f}from"primereact/icons/upload";import{Messages as m}from"primereact/messages";import{ProgressBar as b}from"primereact/progressbar";import{Ripple as y}from"primereact/ripple";function v(e){return v="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},v(e)}function g(e,t){if("object"!==v(e)||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!==v(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function h(e){var t=g(e,"string");return"symbol"===v(t)?t:String(t)}function O(e,t,n){return(t=h(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(){return E=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},E.apply(this,arguments)}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function w(e){if(Array.isArray(e))return S(e)}function N(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function j(e,t){if(e){if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?S(e,t):void 0}}function P(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function B(e){return w(e)||N(e)||j(e)||P()}function x(e){throw new TypeError('"'+e+'" is read-only')}function I(e){if(Array.isArray(e))return e}function C(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,o,a,l,i=[],c=!0,u=!1;try{if(a=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=a.call(n)).done)&&(i.push(r.value),i.length!==t);c=!0);}catch(e){u=!0,o=e}finally{try{if(!c&&null!=n.return&&(l=n.return(),Object(l)!==l))return}finally{if(u)throw o}}return i}}function F(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){return I(e)||C(e,t)||j(e,t)||F()}var D=r.extend({defaultProps:{__TYPE:"Badge",__parentMetadata:null,value:null,severity:null,size:null,style:null,className:null,children:void 0},css:{classes:{root:function(e){var t=e.props;return a("p-badge p-component",O({"p-badge-no-gutter":l.isNotEmpty(t.value)&&1===String(t.value).length,"p-badge-dot":l.isEmpty(t.value),"p-badge-lg":"large"===t.size,"p-badge-xl":"xlarge"===t.size},"p-badge-".concat(t.severity),null!==t.severity))}},styles:"\n@layer primereact {\n    .p-badge {\n        display: inline-block;\n        border-radius: 10px;\n        text-align: center;\n        padding: 0 .5rem;\n    }\n    \n    .p-overlay-badge {\n        position: relative;\n    }\n    \n    .p-overlay-badge .p-badge {\n        position: absolute;\n        top: 0;\n        right: 0;\n        transform: translate(50%,-50%);\n        transform-origin: 100% 0;\n        margin: 0;\n    }\n    \n    .p-badge-dot {\n        width: .5rem;\n        min-width: .5rem;\n        height: .5rem;\n        border-radius: 50%;\n        padding: 0;\n    }\n    \n    .p-badge-no-gutter {\n        padding: 0;\n        border-radius: 50%;\n    }\n}\n"}});function _(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function z(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?_(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):_(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var M=e.memo(e.forwardRef((function(n,r){var l=e.useContext(t),c=D.getProps(n,l),u=D.setMetaData(z({props:c},c.__parentMetadata)),s=u.ptm,p=u.cx;o(D.css.styles,u.isUnstyled,{name:"badge"});var d=e.useRef(null);e.useImperativeHandle(r,(function(){return{props:c,getElement:function(){return d.current}}}));var f=i({ref:d,style:c.style,className:a(c.className,p("root"))},D.getOtherProps(c),s("root"));return e.createElement("span",f,c.value)})));M.displayName="Badge";var L=r.extend({defaultProps:{__TYPE:"FileUpload",id:null,name:null,url:null,mode:"advanced",multiple:!1,accept:null,removeIcon:null,disabled:!1,auto:!1,maxFileSize:null,invalidFileSizeMessageSummary:"{0}: Invalid file size, ",invalidFileSizeMessageDetail:"maximum upload size is {0}.",style:null,className:null,withCredentials:!1,previewWidth:50,chooseLabel:null,uploadLabel:null,cancelLabel:null,chooseOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},uploadOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},cancelOptions:{label:null,icon:null,iconOnly:!1,className:null,style:null},customUpload:!1,headerClassName:null,headerStyle:null,contentClassName:null,contentStyle:null,headerTemplate:null,itemTemplate:null,emptyTemplate:null,progressBarTemplate:null,onBeforeUpload:null,onBeforeSend:null,onBeforeDrop:null,onBeforeSelect:null,onUpload:null,onError:null,onClear:null,onSelect:null,onProgress:null,onValidationFail:null,uploadHandler:null,onRemove:null,children:void 0},css:{classes:{root:function(e){return a("p-fileupload p-fileupload-".concat(e.props.mode," p-component"))},buttonbar:"p-fileupload-buttonbar",content:"p-fileupload-content",chooseButton:function(e){return a("p-button p-fileupload-choose p-component",{"p-disabled":e.disabled,"p-focus":e.focusedState,"p-button-icon-only":e.iconOnly})},label:"p-button-label p-clickable",file:"p-fileupload-row",fileName:"p-fileupload-filename",thumbnail:"p-fileupload-file-thumbnail",chooseButtonLabel:"p-button-label p-clickable",basicButton:function(e){return a("p-button p-component p-fileupload-choose",{"p-fileupload-choose-selected":e.hasFiles,"p-disabled":e.disabled,"p-focus":e.focusedState})},chooseIcon:function(e){var t=e.iconOnly;return a("basic"===e.props.mode?"p-button-icon":"p-button-icon p-clickable",{"p-button-icon-left":!t})},uploadIcon:function(e){return a("p-button-icon p-c",{"p-button-icon-left":!e.iconOnly})},cancelIcon:function(e){return a("p-button-icon p-c",{"p-button-icon-left":!e.iconOnly})}},styles:"\n@layer primereact {\n    .p-fileupload-content {\n        position: relative;\n    }\n    \n    .p-fileupload-row {\n        display: flex;\n        align-items: center;\n    }\n    \n    .p-fileupload-row > div {\n        flex: 1 1 auto;\n        width: 25%;\n    }\n    \n    .p-fileupload-row > div:last-child {\n        text-align: right;\n    }\n    \n    .p-fileupload-content > .p-progressbar {\n        width: 100%;\n        position: absolute;\n        top: 0;\n        left: 0;\n    }\n    \n    .p-button.p-fileupload-choose {\n        position: relative;\n        overflow: hidden;\n    }\n    \n    .p-fileupload-buttonbar {\n        display: flex;\n        flex-wrap: wrap;\n    }\n    \n    .p-button.p-fileupload-choose input[type='file'] {\n        display: none;\n    }\n    \n    .p-fileupload-choose.p-fileupload-choose-selected input[type='file'] {\n        display: none;\n    }\n    \n    .p-fileupload-filename {\n        word-break: break-all;\n    }\n    \n    .p-fileupload-file-thumbnail {\n        flex-shrink: 0;\n    }\n    \n    .p-fileupload-file-badge {\n        margin: 0.5rem;\n    }\n    \n    .p-fluid .p-fileupload .p-button {\n        width: auto;\n    }\n}\n"}});function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function k(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){O(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function A(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=R(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0,o=function(){};return{s:o,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,l=!0,i=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return l=e.done,e},e:function(e){i=!0,a=e},f:function(){try{l||null==n.return||n.return()}finally{if(i)throw a}}}}function R(e,t){if(e){if("string"==typeof e)return X(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?X(e,t):void 0}}function X(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var H=e.memo(e.forwardRef((function(r,v){var g=e.useContext(t),h=L.getProps(r,g),O=T(e.useState([]),2),S=O[0],w=O[1],N=T(e.useState([]),2),j=N[0],P=N[1],I=T(e.useState(0),2),C=I[0],F=I[1],D=T(e.useState(!1),2),_=D[0],z=D[1],U=T(e.useState(!1),2),R=U[0],X=U[1],H={props:h,state:{progress:C,uploading:R,uploadedFiles:S,files:j,focused:_}},J=L.setMetaData(H),V=J.ptm,K=J.cx,W=J.isUnstyled;o(L.css.styles,W,{name:"fileupload"});var Y=e.useRef(null),$=e.useRef(null),q=e.useRef(null),G=e.useRef(0),Q=l.isNotEmpty(j),Z=l.isNotEmpty(S),ee=h.disabled||R,te=h.chooseLabel||h.chooseOptions.label||n("choose"),ne=h.uploadLabel||h.uploadOptions.label||n("upload"),re=h.cancelLabel||h.cancelOptions.label||n("cancel"),oe=ee||h.fileLimit&&h.fileLimit<=j.length+G,ae=ee||!Q,le=ee||!Q,ie=function(e){return/^image\//.test(e.type)},ce=function(e,t){se();var n=B(j),r=j[t];n.splice(t,1),P(n),h.onRemove&&h.onRemove({originalEvent:e,file:r})},ue=function(e,t){se();var n=B(S),r=j[t];n.splice(t,1),w(n),h.onRemove&&h.onRemove({originalEvent:e,file:r})},se=function(){Y.current&&(Y.current.value="")},pe=function(e){var t=n("fileSizeTypes");if(0===e)return"0 ".concat(t[0]);var r=Math.floor(Math.log(e)/Math.log(1024)),o=parseFloat((e/Math.pow(1024,r)).toFixed(3));return"".concat(o," ").concat(t[r])},de=function(e){if(!h.onBeforeSelect||!1!==h.onBeforeSelect({originalEvent:e,files:j})){var t=[];h.multiple&&(t=j?B(j):[]);for(var n=e.dataTransfer?e.dataTransfer.files:e.target.files,r=0;r<n.length;r++){var o=n[r];!fe(o)&&me(o)&&(ie(o)&&(o.objectURL=window.URL.createObjectURL(o)),t.push(o))}P(t),l.isNotEmpty(t)&&h.auto&&be(t),h.onSelect&&h.onSelect({originalEvent:e,files:t}),se(),"basic"===h.mode&&t.length>0&&(Y.current.style.display="none")}},fe=function(e){return j.some((function(t){return t.name+t.type+t.size===e.name+e.type+e.size}))},me=function(e){if(h.maxFileSize&&e.size>h.maxFileSize){var t={severity:"error",summary:h.invalidFileSizeMessageSummary.replace("{0}",e.name),detail:h.invalidFileSizeMessageDetail.replace("{0}",pe(h.maxFileSize)),sticky:!0};return"advanced"===h.mode&&$.current.show(t),h.onValidationFail&&h.onValidationFail(e),!1}return!0},be=function(e){if((e=e||j)&&e.nativeEvent&&(e=j),h.customUpload)h.fileLimit&&x("uploadedFileCount"),h.uploadHandler&&h.uploadHandler({files:e,options:{clear:ye,props:h}});else{X(!0);var t=new XMLHttpRequest,n=new FormData;h.onBeforeUpload&&h.onBeforeUpload({xhr:t,formData:n});var r,o=A(e);try{for(o.s();!(r=o.n()).done;){var a=r.value;n.append(h.name,a,a.name)}}catch(e){o.e(e)}finally{o.f()}t.upload.addEventListener("progress",(function(e){if(e.lengthComputable){var t=Math.round(100*e.loaded/e.total);F(t),h.onProgress&&h.onProgress({originalEvent:e,progress:t})}})),t.onreadystatechange=function(){4===t.readyState&&(F(0),X(!1),t.status>=200&&t.status<300?(h.fileLimit&&x("uploadedFileCount"),h.onUpload&&h.onUpload({xhr:t,files:e})):h.onError&&h.onError({xhr:t,files:e}),ye(),w((function(t){return[].concat(B(t),B(e))})))},t.open("POST",h.url,!0),h.onBeforeSend&&h.onBeforeSend({xhr:t,formData:n}),t.withCredentials=h.withCredentials,t.send(n)}},ye=function(){P([]),w([]),X(!1),h.onClear&&h.onClear(),se()},ve=function(){Y.current.click()},ge=function(){z(!0)},he=function(){z(!1)},Oe=function(e){13===e.which&&ve()},Ee=function(e){if(!h.disabled&&(!W()&&u.removeClass(q.current,"p-fileupload-highlight"),q.current.setAttribute("data-p-highlight",!1),e.stopPropagation(),e.preventDefault(),!h.onBeforeDrop||!1!==h.onBeforeDrop(e))){var t=e.dataTransfer?e.dataTransfer.files:e.target.files;(h.multiple||l.isEmpty(j)&&t&&1===t.length)&&de(e)}},Se=function(){!ee&&Q?be():Y.current.click()};e.useImperativeHandle(v,(function(){return{props:h,upload:be,clear:ye,formatSize:pe,onFileSelect:de,getInput:function(){return Y.current},getContent:function(){return q.current},getFiles:function(){return j},setFiles:function(e){return P(e||[])},getUploadedFiles:function(){return S},setUploadedFiles:function(e){return w(e||[])}}}));var we,Ne,je,Pe,Be,xe,Ie,Ce,Fe,Te,De=function(e,t,n){"warning"===t.severity?ce(e,n):ue(e,n)},_e=function(t,n,r){var o=t.name+t.type+t.size,a=i({role:"presentation",className:K("thumbnail"),src:t.objectURL,width:h.previewWidth},V("thumbnail")),c=ie(t)?e.createElement("img",E({},a,{alt:t.name})):null,u=i(V("details")),p=i(V("fileSize")),f=i({className:K("fileName")},V("fileName")),m=i(V("actions")),b=e.createElement("div",f,t.name),y=e.createElement("div",p,pe(t.size)),v=e.createElement("div",u,e.createElement("div",f," ",t.name),e.createElement("span",p,pe(t.size)),e.createElement(M,{className:"p-fileupload-file-badge",value:r.value,severity:r.severity,pt:V("badge"),__parentMetadata:{parent:H}})),g=e.createElement("div",m,e.createElement(s,{type:"button",icon:h.removeIcon||e.createElement(d,null),text:!0,rounded:!0,severity:"danger",onClick:function(e){return De(e,r,n)},disabled:ee,pt:V("removeButton"),__parentMetadata:{parent:H}})),O=e.createElement(e.Fragment,null,c,v,g);if(h.itemTemplate){var S={onRemove:function(e){return ce(e,n)},previewElement:c,fileNameElement:b,sizeElement:y,removeElement:g,formatSize:pe(t.size),element:O,index:n,props:h};O=l.getJSXElement(h.itemTemplate,t,S)}var w=i({key:o,className:K("file")},V("file"));return e.createElement("div",w,O)},ze=function(){var t={severity:"success",value:n("completed")||"Completed"},r=S&&S.map((function(e,n){return _e(e,n,t)}));return e.createElement("div",null,r)};return"advanced"===h.mode?function(){var t,r,o,v,g,O,S,w,N,P,B,x,I,F,T,D,z,M,U,A=(r=(t=h.chooseOptions).className,o=t.style,v=t.icon,g=t.iconOnly,O=i({className:K("chooseButtonLabel")},V("chooseButtonLabel")),S=g?e.createElement("span",E({},O,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",O,te),w=i({ref:Y,type:"file",onChange:function(e){return de(e)},multiple:h.multiple,accept:h.accept,disabled:oe},V("input")),N=e.createElement("input",w),P=i({className:K("chooseIcon",{iconOnly:g})},V("chooseIcon")),B=c.getJSXIcon(v||e.createElement(p,P),k({},P),{props:h}),x=i({className:a(r,K("chooseButton",{iconOnly:g,disabled:ee,className:r,focusedState:_})),style:o,onClick:ve,onKeyDown:function(e){return Oe(e)},onFocus:ge,onBlur:he,tabIndex:0,"data-p-disabled":ee,"data-p-focus":_},V("chooseButton")),e.createElement("span",x,N,B,S,e.createElement(y,null))),R=!h.emptyTemplate||Q||Z?null:l.getJSXElement(h.emptyTemplate,h);if(!h.auto){var X=h.uploadOptions,J=h.cancelOptions,G=X.iconOnly?"":ne,ie=J.iconOnly?"":re,ce=i({className:K("uploadIcon",{iconOnly:X.iconOnly})},V("uploadIcon")),ue=c.getJSXIcon(X.icon||e.createElement(f,ce),k({},ce),{props:h}),se=i({className:K("cancelIcon",{iconOnly:J.iconOnly})},V("cancelIcon")),pe=c.getJSXIcon(J.icon||e.createElement(d,se),k({},se),{props:h});I=e.createElement(s,{type:"button",label:G,icon:ue,onClick:be,disabled:ae,style:X.style,className:X.className,pt:V("uploadButton"),__parentMetadata:{parent:H}}),F=e.createElement(s,{type:"button",label:ie,icon:pe,onClick:ye,disabled:le,style:J.style,className:J.className,pt:V("cancelButton"),__parentMetadata:{parent:H}})}Q&&(M={severity:"warning",value:n("pending")||"Pending"},U=j.map((function(e,t){return _e(e,t,M)})),T=e.createElement("div",null,U),z=h.progressBarTemplate?l.getJSXElement(h.progressBarTemplate,h):e.createElement(b,{value:C,showValue:!1,pt:V("progressbar"),__parentMetadata:{parent:H}})),Z&&(D=ze());var fe=i({className:a(h.headerClassName,K("buttonbar")),style:h.headerStyle},V("buttonbar")),me=e.createElement("div",fe,A,I,F);if(h.headerTemplate){var Se={className:a("p-fileupload-buttonbar",h.headerClassName),chooseButton:A,uploadButton:I,cancelButton:F,element:me,props:h};me=l.getJSXElement(h.headerTemplate,Se)}var we=i({id:h.id,className:K("root"),style:h.style},L.getOtherProps(h),V("root")),Ne=i({ref:q,className:a(h.contentClassName,K("content")),style:h.contentStyle,onDragEnter:function(e){return t=e,void(ee||(t.dataTransfer.dropEffect="copy",t.stopPropagation(),t.preventDefault()));var t},onDragOver:function(e){return t=e,void(ee||(t.dataTransfer.dropEffect="copy",!W()&&u.addClass(q.current,"p-fileupload-highlight"),q.current.setAttribute("data-p-highlight",!0),t.stopPropagation(),t.preventDefault()));var t},onDragLeave:function(e){return t=e,void(ee||(t.dataTransfer.dropEffect="copy",!W()&&u.removeClass(q.current,"p-fileupload-highlight"),q.current.setAttribute("data-p-highlight",!1)));var t},onDrop:function(e){return Ee(e)},"data-p-highlight":!1},V("content"));return e.createElement("div",we,me,e.createElement("div",Ne,z,e.createElement(m,{ref:$,__parentMetadata:{parent:H}}),Q?T:null,Z?D:null,R))}():"basic"===h.mode?(we=h.chooseOptions,Ne=i({className:K("label")},V("label")),je=we.iconOnly?e.createElement("span",E({},Ne,{dangerouslySetInnerHTML:{__html:"&nbsp;"}})):e.createElement("span",Ne,te),Pe=h.auto?je:e.createElement("span",Ne,Q?j[0].name:je),Be=i({className:K("chooseIcon",{iconOnly:we.iconOnly})},V("chooseIcon")),xe=c.getJSXIcon(we.icon?we.icon:we.icon||Q&&!h.auto?!we.icon&&Q&&!h.auto&&e.createElement(f,Be):e.createElement(p,Be),k({},Be),{props:h,hasFiles:Q}),Ie=i({ref:Y,type:"file",onChange:function(e){return de(e)},multiple:h.multiple,accept:h.accept,disabled:ee},V("input")),Ce=!Q&&e.createElement("input",Ie),Fe=i({className:a(h.className,K("root")),style:h.style},L.getOtherProps(h),V("root")),Te=i({className:a(we.className,K("basicButton",{hasFiles:Q,disabled:ee,focusedState:_})),style:we.style,tabIndex:0,onClick:Se,onKeyDown:function(e){return Oe(e)},onFocus:ge,onBlur:he},L.getOtherProps(h),V("basicButton")),e.createElement("div",Fe,e.createElement(m,{ref:$,pt:V("message"),__parentMetadata:{parent:H}}),e.createElement("span",Te,xe,Pe,Ce,e.createElement(y,null)))):void 0})));H.displayName="FileUpload";export{H as FileUpload};
